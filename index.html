<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞–∑–≤–∏–≤–∞—é—â–∏–µ –∏–≥—Ä—ã –¥–ª—è –º–∞–ª—ã—à–µ–π</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 480px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--tg-theme-text-color, #000);
        }
        
        .age-badge {
            background: var(--tg-theme-button-color, #007aff);
            color: var(--tg-theme-button-text-color, #ffffff);
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 14px;
            display: inline-block;
        }
        
        .activities-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .activity-card {
            background: var(--tg-theme-secondary-bg-color, #f1f1f1);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--tg-theme-section-separator-color, #e1e1e1);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .activity-card:hover {
            transform: translateY(-2px);
        }
        
        .activity-card.premium {
            opacity: 0.6;
            position: relative;
        }
        
        .activity-card.premium::after {
            content: "üíé –ü–†–ï–ú–ò–£–ú";
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ffd700;
            color: #000;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .activity-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--tg-theme-text-color, #000);
        }
        
        .activity-description {
            font-size: 14px;
            color: var(--tg-theme-hint-color, #999);
            margin-bottom: 10px;
        }
        
        .activity-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: var(--tg-theme-hint-color, #999);
        }
        
        .activity-duration {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .activity-props {
            display: flex;
            gap: 8px;
        }
        
        .prop-badge {
            background: var(--tg-theme-button-color, #007aff);
            color: var(--tg-theme-button-text-color, #fff);
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
        }
        
        .premium-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .premium-banner h3 {
            font-size: 20px;
            margin-bottom: 10px;
        }
        
        .premium-banner p {
            margin-bottom: 15px;
            opacity: 0.9;
        }
        
        .premium-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .premium-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--tg-theme-hint-color, #999);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: var(--tg-theme-bg-color, #fff);
            max-width: 480px;
            margin: 50px auto;
            padding: 20px;
            border-radius: 12px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--tg-theme-hint-color, #999);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ –†–∞–∑–≤–∏–≤–∞—é—â–∏–µ –∏–≥—Ä—ã</h1>
            <div class="age-badge">üë∂ 1-2 –≥–æ–¥–∞</div>
        </div>
        
        <div id="premium-banner" class="premium-banner" style="display: none;">
            <h3>üåü –ü—Ä–µ–º–∏—É–º –¥–æ—Å—Ç—É–ø</h3>
            <p>–ü–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—è–º –∏ —Ñ—É–Ω–∫—Ü–∏—è–º</p>
            <button class="premium-btn" onclick="openPremium()">
                –û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
            </button>
        </div>
        
        <div class="loading" id="loading">
            ‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏...
        </div>
        
        <div class="activities-grid" id="activities-grid" style="display: none;">
            <!-- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
    <div class="modal" id="activity-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modal-body">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('user_id') || tg.initDataUnsafe?.user?.id;
        const isPremium = window.location.pathname.includes('premium');
        
        // –î–µ–º–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–ª—è MVP
        const demoActivities = [
            {
                id: 1,
                title: "–ü–∞–ª—å—á–∏–∫–æ–≤–∞—è –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞ ¬´–°–æ—Ä–æ–∫–∞¬ª",
                description: "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∏–≥—Ä–∞ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –º–µ–ª–∫–æ–π –º–æ—Ç–æ—Ä–∏–∫–∏",
                duration: 5,
                requires_device: false,
                requires_props: false,
                is_premium: false,
                category: "physical",
                content: {
                    instructions: `
                        <h4>ü§ö –ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</h4>
                        <p>1. –ü–æ—Å–∞–¥–∏—Ç–µ –º–∞–ª—ã—à–∞ –∫ —Å–µ–±–µ –Ω–∞ –∫–æ–ª–µ–Ω–∏</p>
                        <p>2. –í–æ–∑—å–º–∏—Ç–µ –µ–≥–æ –ª–∞–¥–æ—à–∫—É –≤ —Å–≤–æ—é —Ä—É–∫—É</p>
                        <p>3. –í–æ–¥–∏—Ç–µ –ø–∞–ª—å—á–∏–∫–æ–º –ø–æ –ª–∞–¥–æ—à–∫–µ –∏ –≥–æ–≤–æ—Ä–∏—Ç–µ:</p>
                        <blockquote>"–°–æ—Ä–æ–∫–∞-–≤–æ—Ä–æ–Ω–∞ –∫–∞—à—É –≤–∞—Ä–∏–ª–∞, –¥–µ—Ç–æ–∫ –∫–æ—Ä–º–∏–ª–∞..."</blockquote>
                        <p>4. –ó–∞–≥–∏–±–∞–π—Ç–µ –ø–∞–ª—å—á–∏–∫–∏ –ø–æ –æ—á–µ—Ä–µ–¥–∏</p>
                        
                        <h4>üéØ –†–∞–∑–≤–∏–≤–∞–µ—Ç:</h4>
                        <ul>
                            <li>–ú–µ–ª–∫—É—é –º–æ—Ç–æ—Ä–∏–∫—É</li>
                            <li>–†–µ—á—å –∏ –ø–∞–º—è—Ç—å</li>
                            <li>–¢–∞–∫—Ç–∏–ª—å–Ω—ã–µ –æ—â—É—â–µ–Ω–∏—è</li>
                        </ul>
                    `
                }
            },
            {
                id: 2,
                title: "–ò–≥—Ä–∞ —Å –º—è—á–∏–∫–æ–º",
                description: "–ö–∞—Ç–∞–Ω–∏–µ –º—è—á–∞ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏",
                duration: 10,
                requires_device: false,
                requires_props: true,
                is_premium: false,
                category: "physical",
                content: {
                    instructions: `
                        <h4>‚öΩ –ß—Ç–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è:</h4>
                        <p>‚Ä¢ –ú—è–≥–∫–∏–π –º—è—á —Å—Ä–µ–¥–Ω–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞</p>
                        
                        <h4>üéÆ –ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</h4>
                        <p>1. –°—è–¥—å—Ç–µ –Ω–∞ –ø–æ–ª –Ω–∞–ø—Ä–æ—Ç–∏–≤ —Ä–µ–±–µ–Ω–∫–∞</p>
                        <p>2. –ö–∞—Ç–∞–π—Ç–µ –º—è—á –¥—Ä—É–≥ –¥—Ä—É–≥—É</p>
                        <p>3. –ì–æ–≤–æ—Ä–∏—Ç–µ: "–õ–æ–≤–∏ –º—è—á–∏–∫!", "–ö–∞—Ç–∏ –º—è—á–∏–∫!"</p>
                        <p>4. –•–≤–∞–ª–∏—Ç–µ –∑–∞ –∫–∞–∂–¥—É—é –ø–æ–ø—ã—Ç–∫—É</p>
                        
                        <h4>üéØ –†–∞–∑–≤–∏–≤–∞–µ—Ç:</h4>
                        <ul>
                            <li>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é –¥–≤–∏–∂–µ–Ω–∏–π</li>
                            <li>–ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–µ—á–∏</li>
                            <li>–°–æ—Ü–∏–∞–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ</li>
                        </ul>
                    `
                }
            },
            {
                id: 3,
                title: "–ò–∑—É—á–∞–µ–º –∂–∏–≤–æ—Ç–Ω—ã—Ö",
                description: "–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∏–≥—Ä–∞ —Å –∑–≤—É–∫–∞–º–∏ –∂–∏–≤–æ—Ç–Ω—ã—Ö",
                duration: 8,
                requires_device: true,
                requires_props: false,
                is_premium: false,
                category: "cognitive",
                content: {
                    instructions: `
                        <h4>üì± –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∏–≥—Ä–∞</h4>
                        <div id="animals-game">
                            <div class="animal-card" onclick="playAnimalSound('cow')">
                                <div style="font-size: 60px;">üêÑ</div>
                                <p><strong>–ö–æ—Ä–æ–≤–∞</strong></p>
                                <p>–ù–∞–∂–º–∏ –∏ –ø–æ—Å–ª—É—à–∞–π!</p>
                            </div>
                        </div>
                        
                        <h4>üéØ –†–∞–∑–≤–∏–≤–∞–µ—Ç:</h4>
                        <ul>
                            <li>–ü–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏</li>
                            <li>–°–ª—É—Ö–æ–≤–æ–µ –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ</li>
                            <li>–°–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å</li>
                        </ul>
                    `
                }
            },
            // –ü—Ä–µ–º–∏—É–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            {
                id: 4,
                title: "–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã",
                description: "–ò–∑—É—á–∞–µ–º –∑–≤—É–∫–∏ —Ä–∞–∑–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤",
                duration: 12,
                requires_device: true,
                requires_props: false,
                is_premium: true,
                category: "creative"
            },
            {
                id: 5,
                title: "–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ü–≤–µ—Ç–∞–º",
                description: "–ò–≥—Ä–∞ —Å —Ä–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω—ã–º–∏ –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏",
                duration: 15,
                requires_device: false,
                requires_props: true,
                is_premium: true,
                category: "cognitive"
            }
        ];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        async function initApp() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏
                const hasAccess = await checkPremiumAccess();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
                renderActivities(hasAccess);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–Ω–Ω–µ—Ä –ø—Ä–µ–º–∏—É–º–∞ –µ—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞
                if (!hasAccess && !isPremium) {
                    document.getElementById('premium-banner').style.display = 'block';
                }
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('activities-grid').style.display = 'grid';
                
            } catch (error) {
                console.error('Init error:', error);
                document.getElementById('loading').innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
            }
        }
        
        async function checkPremiumAccess() {
            if (isPremium) return true;
            
            try {
                const response = await fetch(`/api/subscription/${userId}`);
                const data = await response.json();
                return data.hasPremium;
            } catch (error) {
                console.error('Error checking premium access:', error);
                return false;
            }
        }
        
        function renderActivities(hasAccess) {
            const grid = document.getElementById('activities-grid');
            grid.innerHTML = '';
            
            const availableActivities = hasAccess 
                ? demoActivities 
                : demoActivities.filter(activity => !activity.is_premium);
            
            availableActivities.forEach(activity => {
                const card = createActivityCard(activity, hasAccess);
                grid.appendChild(card);
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            if (!hasAccess) {
                const premiumActivities = demoActivities.filter(activity => activity.is_premium);
                premiumActivities.forEach(activity => {
                    const card = createActivityCard(activity, false);
                    card.classList.add('premium');
                    grid.appendChild(card);
                });
            }
        }
        
        function createActivityCard(activity, hasAccess) {
            const card = document.createElement('div');
            card.className = 'activity-card';
            
            const canAccess = hasAccess || !activity.is_premium;
            
            card.innerHTML = `
                <div class="activity-title">${activity.title}</div>
                <div class="activity-description">${activity.description}</div>
                <div class="activity-meta">
                    <div class="activity-duration">
                        ‚è∞ ${activity.duration} –º–∏–Ω
                    </div>
                    <div class="activity-props">
                        ${activity.requires_device ? '<span class="prop-badge">üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</span>' : ''}
                        ${activity.requires_props ? '<span class="prop-badge">üéØ –†–µ–∫–≤–∏–∑–∏—Ç</span>' : ''}
                        ${activity.is_premium ? '<span class="prop-badge" style="background: #ffd700; color: #000;">üíé –ü—Ä–µ–º–∏—É–º</span>' : ''}
                    </div>
                </div>
            `;
            
            card.addEventListener('click', () => {
                if (canAccess) {
                    openActivity(activity);
                } else {
                    openPremium();
                }
            });
            
            return card;
        }
        
        function openActivity(activity) {
            const modal = document.getElementById('activity-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');
            
            title.textContent = activity.title;
            
            if (activity.content && activity.content.instructions) {
                body.innerHTML = activity.content.instructions;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                if (activity.id === 3) { // –ò–≥—Ä–∞ —Å –∂–∏–≤–æ—Ç–Ω—ã–º–∏
                    setupAnimalsGame();
                }
            } else {
                body.innerHTML = `
                    <p>${activity.description}</p>
                    <p><em>–ö–æ–Ω—Ç–µ–Ω—Ç –¥–∞–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...</em></p>
                `;
            }
            
            modal.style.display = 'block';
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –≤ Telegram
            if (window.Telegram?.WebApp) {
                window.Telegram.WebApp.HapticFeedback.impactOccurred('medium');
            }
        }
        
        function setupAnimalsGame() {
            // –°—Ç–∏–ª–∏ –¥–ª—è –∏–≥—Ä—ã —Å –∂–∏–≤–æ—Ç–Ω—ã–º–∏
            const style = document.createElement('style');
            style.textContent = `
                .animal-card {
                    background: var(--tg-theme-secondary-bg-color, #f1f1f1);
                    border-radius: 12px;
                    padding: 20px;
                    text-align: center;
                    cursor: pointer;
                    transition: transform 0.2s;
                    margin: 10px 0;
                }
                .animal-card:hover {
                    transform: scale(1.05);
                }
                .animal-card:active {
                    transform: scale(0.95);
                }
            `;
            document.head.appendChild(style);
        }
        
        function playAnimalSound(animal) {
            const sounds = {
                cow: { sound: '–ú—É-—É-—É!', emoji: 'üêÑ' }
            };
            
            const animalData = sounds[animal];
            if (animalData) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–≤—É–∫ –≤–∏–∑—É–∞–ª—å–Ω–æ
                const soundDisplay = document.createElement('div');
                soundDisplay.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    font-size: 48px;
                    background: rgba(0,0,0,0.8);
                    color: white;
                    padding: 20px;
                    border-radius: 20px;
                    z-index: 2000;
                    animation: soundPulse 1s ease-out;
                `;
                soundDisplay.innerHTML = `${animalData.emoji}<br>${animalData.sound}`;
                
                // –î–æ–±–∞–≤–ª—è–µ–º CSS –∞–Ω–∏–º–∞—Ü–∏—é
                if (!document.querySelector('#sound-animation')) {
                    const animationStyle = document.createElement('style');
                    animationStyle.id = 'sound-animation';
                    animationStyle.textContent = `
                        @keyframes soundPulse {
                            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
                            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(animationStyle);
                }
                
                document.body.appendChild(soundDisplay);
                
                // –£–±–∏—Ä–∞–µ–º —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
                setTimeout(() => {
                    soundDisplay.remove();
                }, 1000);
                
                // –í–∏–±—Ä–∞—Ü–∏—è –µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
                if (window.Telegram?.WebApp) {
                    window.Telegram.WebApp.HapticFeedback.impactOccurred('heavy');
                }
            }
        }
        
        function closeModal() {
            document.getElementById('activity-modal').style.display = 'none';
        }
        
        function openPremium() {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –±–æ—Ç—É –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é –ø—Ä–µ–º–∏—É–º–∞
            if (window.Telegram?.WebApp) {
                window.Telegram.WebApp.sendData('open_premium');
                window.Telegram.WebApp.close();
            } else {
                alert('–î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Telegram –±–æ—Ç');
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.addEventListener('click', (e) => {
            const modal = document.getElementById('activity-modal');
            if (e.target === modal) {
                closeModal();
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" Telegram
        if (window.Telegram?.WebApp) {
            window.Telegram.WebApp.BackButton.onClick(() => {
                const modal = document.getElementById('activity-modal');
                if (modal.style.display === 'block') {
                    closeModal();
                    window.Telegram.WebApp.BackButton.hide();
                } else {
                    window.Telegram.WebApp.close();
                }
            });
        }
        
        // –ü–æ–∫–∞–∑ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function showBackButton() {
            if (window.Telegram?.WebApp) {
                window.Telegram.WebApp.BackButton.show();
            }
        }
        
        function hideBackButton() {
            if (window.Telegram?.WebApp) {
                window.Telegram.WebApp.BackButton.hide();
            }
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é openActivity
        const originalOpenActivity = openActivity;
        openActivity = function(activity) {
            originalOpenActivity(activity);
            showBackButton();
        };
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é closeModal
        const originalCloseModal = closeModal;
        closeModal = function() {
            originalCloseModal();
            hideBackButton();
        };
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        initApp();
    </script>
</body>
</html>
